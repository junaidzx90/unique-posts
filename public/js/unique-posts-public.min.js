jQuery(document).ready((function($){$(".uposts_table").DataTable({columnDefs:[{type:"date",targets:[5]}],order:[[5,"desc"]],language:{paginate:{previous:'<span class="fa fa-chevron-left"></span>',next:'<span class="fa fa-chevron-right"></span>'},lengthMenu:'Display <select class="form-control input-sm"><option value="10">10</option><option value="20">20</option><option value="30">30</option><option value="40">40</option><option value="50">50</option><option value="-1">All</option></select> results'}});var numPager=1;function readImageURL(input){if(input.files){$(".upost_image_previews").html("");for(let i=0;i<input.files.length;i++){var reader=new FileReader;reader.onload=function(e){$(".upost_image_previews").append(`<div class="single_img"><img width="100px" align='middle'src="${e.target.result}"/></div>`)},reader.readAsDataURL(input.files[i])}}}function upost_pdf_view(pFile,numPage=1){let filename="",canvas;filename=pFile.split("/").pop();let pdfjsLib=window["pdfjs-dist/build/pdf"];pdfjsLib.GlobalWorkerOptions.workerSrc="pdf.warker.js",canvas=document.createElement("CANVAS");let pdfDoc=null,scale=1,viewport,ctx=canvas.getContext("2d");function renderPage(){pdfDoc.getPage(numPage).then((function(page){viewport=page.getViewport({scale:1}),canvas.height=viewport.height,canvas.width=viewport.width;let renderContext={canvasContext:ctx,viewport:viewport},renderTask;page.render(renderContext).promise.then((function(){$(".upost_pdf_previews img").attr("src",canvas.toDataURL("image/jpeg"))}))}))}pdfjsLib.getDocument(pFile).promise.then((function(pdfDoc_){return pdfDoc=pdfDoc_,numPager>pdfDoc.numPages?(numPager=pdfDoc.numPages,!1):numPager<1?(numPager=1,!1):($(".leftPdfPage").css("display","inline-block"),$(".rightPdfPage").css("display","inline-block"),1===pdfDoc.numPages&&($(".leftPdfPage").css("display","none"),$(".rightPdfPage").css("display","none")),numPager==pdfDoc.numPages&&$(".rightPdfPage").css("display","none"),1==numPager&&$(".leftPdfPage").css("display","none"),void renderPage())}))}function readPdfURL(input){if(input.files&&input.files[0]){var reader=new FileReader;reader.onload=function(e){upost_pdf_view(e.target.result)},reader.readAsDataURL(input.files[0])}}function load_post_preview(img){$("#upost_image_preview img").attr("src",img)}function generateZIP(links,zipFilename){var zip=new JSZip,count=0;links.forEach((function(url,i){var filename=links[i];filename=filename.replace(/[\/\*\|\:\<\>\?\"\\]/gi,"").replace("easeare.com",""),JSZipUtils.getBinaryContent(url,(function(err,data){if(err)throw err;zip.file(filename,data,{binary:!0}),++count==links.length&&zip.generateAsync({type:"blob"}).then((function(content){saveAs(content,zipFilename)}))}))}))}$("#post_type").on("change",(function(){switch($(".upost_content").addClass("dnone"),$("#upload_upost_images").val(""),$(".upost_image_previews").html(""),$("#upload_upost_pdf").val(""),$(".upost_pdf_previews img").attr("src",""),$("#patient_name").val(""),$("#id_number").val(""),$("#patient_age").val(""),$("#patient_email").val(""),$("#patient_phone").val(""),$("#start_date").val(""),$("#end_date").val(""),$("#description").val(""),""===$("#upload_upost_pdf").val()?$("label[for='upload_upost_pdf'] span").text("Upload PDF"):$("label[for='upload_upost_pdf'] span").text("Replace PDF"),tinymce.get("upost_article_content").setContent(""),$(this).val()){case"article":$("#article_content").removeClass("dnone");break;case"images":$("#images_content").removeClass("dnone");break;case"pdf":$("#pdf_content").removeClass("dnone");break;case"certificate":$("#certificate_content").removeClass("dnone")}})),$("#upload_upost_images").change((function(){readImageURL(this)})),$(document).find("#pdf_loader").length>0&&""!==$("#pdf_loader").val()&&upost_pdf_view($("#pdf_loader").val()),$("#upload_upost_pdf").change((function(){""===$(this).val()?($("#upload_upost_pdf").val(""),$(".upost_pdf_previews img").attr("src",""),$("label[for='upload_upost_pdf'] span").text("Upload PDF")):$("label[for='upload_upost_pdf'] span").text("Replace PDF"),readPdfURL(this)})),load_post_preview($(".upost_image.active").find("img").attr("src")),$(".upost_image").on("click",(function(){$(this).siblings().removeClass("active"),$(this).addClass("active"),load_post_preview($(this).find("img").attr("src"))})),$(document).find("#upost_pdf_preview").length>0&&upost_pdf_view($("#upost_pdf_preview").attr("data-src")),$(".leftPdfPage").on("click",(function(){numPager>1&&(numPager--,upost_pdf_view($("#upost_pdf_preview").attr("data-src"),numPager))})),$(".rightPdfPage").on("click",(function(){numPager++,upost_pdf_view($("#upost_pdf_preview").attr("data-src"),numPager)})),$("a.download-file").on("click",(function(e){e.preventDefault();var link=document.createElement("a");link.href=$(this).attr("data-pdf"),link.download=$(this).attr("data-name")+".pdf",link.dispatchEvent(new MouseEvent("click")),$(".action_popup").addClass("dnone")})),$("a.download-images").on("click",(function(e){e.preventDefault();let links=[];$(".upost_image").each((function(){links.push($(this).find("img").attr("src"))})),generateZIP(links,$(this).attr("data-name"))})),$(document).on("click",".action_btn",(function(){$(this).parents("tr").siblings().find(".action_popup").addClass("dnone"),$(this).parents("td").find(".action_popup").toggleClass("dnone")})),$(document).on("click",".account_btn",(function(e){e.preventDefault(),$(this).parents(".account_menu").find(".account_popup").toggleClass("dnone")})),$(document).on("click",".upost-del-btn",(function(e){confirm("Are you sure to delete this post?")||e.preventDefault()})),$(document).on("click",".shareBTN",(function(e){e.preventDefault(),$(this).next(".sharing_popup").removeClass("dnone"),$("body").css("overflow","hidden")})),$(document).on("click",".closeUrlPopup",(function(){$(this).parents(".sharing_popup").addClass("dnone")})),$(document).on("click",".copy_post_url",(function(){let input=$(this).parents(".url_field").find(".share_post_url");input[0].select(),input[0].setSelectionRange(0,99999),navigator.clipboard.writeText(input.val()),$(this).parents(".url_field").find(".tooltiptext").text("Copied")})),$(document).on("mouseout",".copy_post_url",(function(){$(this).parents(".url_field").find(".tooltiptext").text("Copy to clipboard")}));var certificate=$("#medical_certificate"),cache_width=certificate.width(),a4=[595.28,841.89];function createPDF(){getCanvas().then((function(canvas){var img=canvas.toDataURL("image/png"),doc=new jsPDF({unit:"px",format:"a4"});doc.addImage(img,"JPEG",20,20),doc.save("bhavdip-html-to-pdf.pdf"),certificate.width(cache_width)}))}function getCanvas(){return certificate.width(1.33333*a4[0]-80).css("max-width","none"),html2canvas(form,{imageTimeout:2e3,removeContainer:!0})}$("#certificate_download").on("click",(function(e){e.preventDefault(),$("body").scrollTop(0),createPDF()}))})),function($){$.fn.html2canvas=function(options){var date=new Date,$message=null,timeoutTimer=!1,timer=date.getTime();function throwMessage(msg,duration){window.clearTimeout(timeoutTimer),timeoutTimer=window.setTimeout((function(){$message.fadeOut((function(){$message.remove()}))}),duration||2e3),$message&&$message.remove(),$message=$("<div ></div>").html(msg).css({margin:0,padding:10,background:"#000",opacity:.7,position:"fixed",top:10,right:10,fontFamily:"Tahoma",color:"#fff",fontSize:12,borderRadius:12,width:"auto",height:"auto",textAlign:"center",textDecoration:"none"}).hide().fadeIn().appendTo("body")}html2canvas.logging=options&&options.logging,html2canvas.Preload(this[0],$.extend({complete:function(images){var queue=html2canvas.Parse(this[0],images,options),$canvas=$(html2canvas.Renderer(queue,options)),finishTime=new Date;$canvas.css({position:"absolute",left:0,top:0}).appendTo(document.body),$canvas.siblings().toggle(),$(window).click((function(){$canvas.is(":visible")?($canvas.siblings().toggle(),$canvas.toggle(),throwMessage("Canvas Render hidden")):($canvas.toggle().siblings().toggle(),throwMessage("Canvas Render visible"))})),throwMessage("Screenshot created in "+(finishTime.getTime()-timer)/1e3+" seconds<br />",4e3)}},options))}}(jQuery);